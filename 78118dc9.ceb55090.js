(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{130:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var f=o.a.createContext({}),l=function(e){var t=o.a.useContext(f),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=l(e.components);return o.a.createElement(f.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,f=s(e,["components","mdxType","originalType","parentName"]),u=l(n),d=r,m=u["".concat(c,".").concat(d)]||u[d]||b[d]||a;return n?o.a.createElement(m,i(i({ref:t},f),{},{components:n})):o.a.createElement(m,i({ref:t},f))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,c=new Array(a);c[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var f=2;f<a;f++)c[f]=n[f];return o.a.createElement.apply(null,c)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},89:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return a})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return f}));var r=n(2),o=(n(0),n(130));const a={id:"effect-hooks",title:"Effect Hooks",sidebar_label:"Effect Hooks"},c={unversionedId:"hooks/effect-hooks",id:"hooks/effect-hooks",isDocsHomePage:!1,title:"Effect Hooks",description:"Overview",source:"@site/docs/general/hooks/effect.md",slug:"/hooks/effect-hooks",permalink:"/docs/hooks/effect-hooks",editUrl:"https://github.com/polyhorn/polyhorn.github.io/edit/master/docs/general/hooks/effect.md",version:"current",sidebar_label:"Effect Hooks",sidebar:"someSidebar",previous:{title:"State Hooks",permalink:"/docs/hooks/state-hooks"},next:{title:"Reference Hooks",permalink:"/docs/hooks/reference-hooks"}},i=[{value:"Overview",id:"overview",children:[]},{value:"Declaration",id:"declaration",children:[]},{value:"Usage",id:"usage",children:[]},{value:"Roadmap",id:"roadmap",children:[]}],s={rightToc:i};function f({components:e,...t}){return Object(o.b)("wrapper",Object(r.a)({},s,t,{components:e,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"overview"},"Overview"),Object(o.b)("p",null,"Sometimes, you might want to run some imperative code after a component is\nmounted. With effect hooks, you can schedule closures for execution at the end\nof a render cycle."),Object(o.b)("h2",{id:"declaration"},"Declaration"),Object(o.b)("p",null,"The effect hook is declared via a ",Object(o.b)("inlineCode",{parentName:"p"},"UseEffect")," trait. The hook can be used on any\ntype that implements this trait."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-rust",metastring:'title="Definition"',title:'"Definition"'}),"pub trait UseEffect<P> where P: Platform {\n    fn use_effect<F>(&mut self, key: Key, condition: Option<Key>, effect: F)\n    where\n        F: FnOnce(&mut P::CommandBuffer) + 'static;\n}\n")),Object(o.b)("p",null,"Effects are closures that accept a mutable reference to the platform's command\nbuffer. The command buffer can be used to queue commands that are executed on\nthe main thread and interface directly with native elements (such as ",Object(o.b)("inlineCode",{parentName:"p"},"UIView"),"s\non iOS). All commands generated in effects are queued in the buffer and\ncommitted atomically (i.e. jitter-free) only after the entire render has\nfinished."),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"'static")," lifetime required stems from the fact that the effect is scheduled\nto run after the render function has returned. Specifically: it may not hold any\nreferences to local variables of the render function."),Object(o.b)("p",null,"It is recommended to use the macro instead of interfacing with the trait\ndirectly. The macro will generate a unique invocation ID that is used as its\nkey."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-rust",metastring:'title="Definition"',title:'"Definition"'}),"use_effect!($manager:expr, $effect:expr) => {\n    UseEffect::use_effect($manager, use_id!(), None, $effect);\n}\n")),Object(o.b)("h2",{id:"usage"},"Usage"),Object(o.b)("p",null,"Effects can be used in conjunction with references to run imperative code after\ncomponents are mounted but before they are shown to the user."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-rust"}),"fn render(&self, manager: &mut Manager) -> Element {\n    let button_ref = use_reference!(manager);\n \n    // The reference is `None` until it mounts.\n    assert_eq!(button_ref.is_some(), false);\n \n    use_effect!(manager, {\n        let button_ref = button_ref.clone();\n \n        move |_| {\n            // The reference is `Some(...)` within the effect.\n            assert_eq!(button_ref.is_some(), true)\n        }\n    });\n \n    poly!(<Button reference=button_ref ... />)\n}\n")),Object(o.b)("p",null,"Unfortunately, references still need to be cloned, which makes this example more\nverbose than it could be. It's one of the open issues with\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/hooks/reference-hooks/"}),"reference hooks"),"."),Object(o.b)("h2",{id:"roadmap"},"Roadmap"),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"There are some open issues related to the behavior of effect hooks. If you have\nthoughts, please let us know on\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/polyhorn/polyhorn"}),"our Github"),"."),Object(o.b)("ol",{parentName:"div"},Object(o.b)("li",{parentName:"ol"},"Unlike React, we don't distinguish between regular effects and layout\neffects."),Object(o.b)("li",{parentName:"ol"},"The behavior of our regular effects is identical to layout effects of React."),Object(o.b)("li",{parentName:"ol"},"Effect closures currently always accept the platform's command buffer even\nthough this should only be accessed by one of the platform crates (e.g.\n",Object(o.b)("inlineCode",{parentName:"li"},"polyhorn-ios"),")."),Object(o.b)("li",{parentName:"ol"},"We currently do not yet support conditional effects through our macro\nsyntax.")))))}f.isMDXComponent=!0}}]);